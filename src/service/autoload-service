#!/usr/bin/env bash

__autoload_service_submodules_path="$GIT_PATH/$SUBMODULES_DIR"
__autoload_service_resource_file="$AUTOLOAD_RESOURCE"
__autoload_service_project_file="$SUBMODULES_DIR/$(basename "$AUTOLOAD_RESOURCE")"

##
# Refresh the submarine autoload file.
##
autoload_service::refresh() {
    local submodules_path="$__autoload_service_submodules_path"
    local resource_file="$__autoload_service_resource_file"
    local project_file="$__autoload_service_project_file"

    if [[ ! -d "$submodules_path" ]]; then
        echo "The directory for submodules does not exist!"

        return 1
    fi

    cp -f "$resource_file" "$submodules_path/"

    # add autoload path to project's .gitignore
    if [[ ! -e .gitignore ]]; then
        echo "$project_file" > .gitignore
    elif $(grep -q "^${project_file}$" .gitignore); then
        echo "$project_file" >> .gitignore
    fi
}

##
# Removes the submarine autoload file.
##
autoload_service::remove() {
    local project_file="$__autoload_service_project_file"

    if [[ -f "$project_file" ]]; then
        rm -f "$project_file"
    fi

    # removes autoload file from project's .gitignore, if it's there
    echo "$(grep -v "^${project_file}$" .gitignore)" > .gitignore
}
