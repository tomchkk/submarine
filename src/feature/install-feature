#!/usr/bin/env bash

source "$service/submodule-service"

##
# Installs all configured submodules.
##
install_feature::install_all() {
    local paths=$(submodule_service::get_configured_paths)

    for path in ${paths[@]}; do
        __install_feature::install $path
    done

    __install_feature::install_dependencies ${paths[@]}
}

##
# Installs the given submodule paths or names.
##
install_feature::install_named() {
    local submodules=$@
    local paths=()

    for submodule in ${submodules[@]}; do
        local path=$(submodule_service::get_path_for_value "$submodule")

        if [[ -z $path ]] ; then
            echo "The submodule '$submodule' does not exist!"

            echo "Configured submodule paths:"
            for path in $(submodule_service::get_configured_paths); do
                echo " - $path"
            done

            return 1
        fi

        __install_feature::install $path

        paths+=("$path")
    done

    __install_feature::install_dependencies ${paths[@]}
}

##
# Installs the given submodule.
##
__install_feature::install() {
    local path=${1:?"A submodule path is required"}

    echo "Installing '$path'..."

    submodule_service::install_path $path
}

##
# Installs submodule dependencies for a given array of paths.
##
__install_feature::install_dependencies() {
    local paths=$@

    for path in ${paths[@]}; do
        echo "Installing dependencies for '$path'"

        source "$service/dependency-service" $path
        dependency_service::install_dependencies
    done
}
