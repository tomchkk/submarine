#!/usr/bin/env bash -f
# -f is used to disable variable expansion, allowing use of '*' as a version
# constraint

echo "readlink: $(readlink ${BASH_SOURCE[0]})"
echo "bash_source: ${BASH_SOURCE[0]}"
echo "pwd: $PWD"


__script=$(readlink "${BASH_SOURCE[0]}" || echo "${BASH_SOURCE[0]}")
echo "__script: $__script"

# CDPATH="$(dirname ${BASH_SOURCE[0]}):$CDPATH"
__app_dir="$(
    cd $(dirname ${BASH_SOURCE[0]})
    cd $(dirname "$__script")
    pwd
)"
echo "__app_dir: $__app_dir"

__app_dir_2="$(cd $(); pwd)"

APP_VERSION="$(cd $__app_dir; git describe --always --first-parent HEAD 2>/dev/null)"

source "$__app_dir/.env"

APP_NAME="${APP_NAME:-$(basename $0)}"
SUBMODULES_DIR="${SUBMODULES_DIR:-submodules}"

AUTOLOAD_RESOURCE="$__app_dir/resource/autoload"

__app_src="$__app_dir/src"

source "$__app_src/kernel" $@
